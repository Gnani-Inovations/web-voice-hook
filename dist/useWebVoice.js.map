{"version":3,"file":"useWebVoice.js","names":["AudioMotionAnalyzer","useCallback","useMemo","useRef","useState","applyCustomColor","base64ToPCM16Data","convertPCMDataToFloat32","getBase64Audio","getVisualizerOptions","resampleAudio","resetAudioInput","SAMPLE_RATE","CHANNELS","BITS_PER_SAMPLE","defaultLogger","info","arg","args","console","log","error","DEFAULT_WORKLET_PATH","useWebSocketAudio","websocketUrl","workletPath","visualizerOptions","elementId","visualizerElementId","color","visualizerColor","options","events","eventsOption","logger","loggerOption","onOpen","onClose","onException","isPlaying","setIsPlaying","websocketRef","audioContextRef","sourceNodeRef","isPlayingRef","isFirstChunk","streamRef","isAudioNodesConnected","isCleanedUp","backendSampleRate","isStopReceived","lastSentTTSEvent","chunkReceivedAt","analyzerRef","isConnected","setIsConnected","isPlayingAudio","audioBufferRef","getOrCreateAudioContext","current","state","window","AudioContext","webkitAudioContext","sampleRate","latencyHint","initializeVisualizer","source","connectInput","analyzer","document","getElementById","start","setupAudioStream","async","navigator","mediaDevices","getUserMedia","audio","channelCount","echoCancellation","ideal","noiseSuppression","autoGainControl","audioContext","createMediaStreamSource","compressor","createDynamicsCompressor","threshold","value","knee","ratio","attack","release","gainNode","createGain","gain","connect","e","startProcessing","stopProcessing","isProcessing","audioWorkletNode","sourceNode","audioWorklet","addModule","AudioWorkletNode","numberOfInputs","numberOfOutputs","processorOptions","port","onmessage","event","readyState","WebSocket","OPEN","data","timestamp","base64Data","send","JSON","stringify","media","payload","disconnect","processAudioChunk","pcm16Data","float32Data","rightSampled","push","reduce","acc","chunk","length","playNextChunk","audioData","tts_playing","silenceLength","Math","floor","Float32Array","fill","totalLength","chunks","shift","offset","set","audioBuffer","createBuffer","getChannelData","createBufferSource","buffer","destination","onended","close","processAudioMessage","message","Date","now","sample_rate","includes","cleanup","CONNECTING","stop","destroy","getTracks","forEach","track","enabled","removeTrack","undefined","ws","onopen","parse","onclose","reason","location","reload","onerror","reconnect","onConnectionSuccess","startRecording","stopRecording","isRecording"],"sources":["../src/useWebVoice.ts"],"mappings":"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","ignoreList":[]}