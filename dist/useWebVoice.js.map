{"version":3,"file":"useWebVoice.js","names":["AudioMotionAnalyzer","useCallback","useMemo","useRef","useState","audioProcessorSource","applyCustomColor","base64ToPCM16Data","convertPCMDataToFloat32","getBase64Audio","getVisualizerOptions","resampleAudio","resetAudioInput","SAMPLE_RATE","CHANNELS","BITS_PER_SAMPLE","defaultLogger","info","arg","args","console","log","error","useWebSocketAudio","websocketUrl","workletPath","visualizerOptions","elementId","visualizerElementId","color","visualizerColor","options","events","eventsOption","logger","loggerOption","onOpen","onClose","onException","isPlaying","setIsPlaying","websocketRef","audioContextRef","sourceNodeRef","isPlayingRef","isFirstChunk","streamRef","isAudioNodesConnected","isCleanedUp","backendSampleRate","isStopReceived","lastSentTTSEvent","chunkReceivedAt","analyzerRef","isConnected","setIsConnected","isPlayingAudio","audioBufferRef","getOrCreateAudioContext","current","state","window","AudioContext","webkitAudioContext","sampleRate","latencyHint","initializeVisualizer","source","connectInput","analyzer","document","getElementById","start","setupAudioStream","async","navigator","mediaDevices","getUserMedia","audio","channelCount","echoCancellation","ideal","noiseSuppression","autoGainControl","audioContext","createMediaStreamSource","compressor","createDynamicsCompressor","threshold","value","knee","ratio","attack","release","gainNode","createGain","gain","connect","e","startProcessing","stopProcessing","isProcessing","audioWorkletNode","sourceNode","useEmbedded","undefined","workletUrl","URL","createObjectURL","Blob","type","audioWorklet","addModule","revokeObjectURL","AudioWorkletNode","numberOfInputs","numberOfOutputs","processorOptions","port","onmessage","event","readyState","WebSocket","OPEN","data","timestamp","base64Data","send","JSON","stringify","media","payload","disconnect","processAudioChunk","pcm16Data","float32Data","rightSampled","push","reduce","acc","chunk","length","playNextChunk","audioData","tts_playing","silenceLength","Math","floor","Float32Array","fill","totalLength","chunks","shift","offset","set","audioBuffer","createBuffer","getChannelData","createBufferSource","buffer","destination","onended","close","processAudioMessage","message","Date","now","sample_rate","includes","cleanup","CONNECTING","stop","destroy","getTracks","forEach","track","enabled","removeTrack","ws","onopen","parse","onclose","reason","location","reload","onerror","reconnect","onConnectionSuccess","startRecording","stopRecording","isRecording"],"sources":["../src/useWebVoice.ts"],"mappings":"OASOA,wBAAyB,8BACvBC,YAAaC,QAASC,OAAQC,aAAgB,eAE9CC,yBAA4B,0CAGnCC,iBACAC,kBACAC,wBACAC,eACAC,qBACAC,cACAC,oBACK,kBAGP,MAAMC,YAAc,aACb,MAAMC,SAAW,SACjB,MAAMC,gBAAkB,GAG/B,MAAMC,cAAgB,CACpBC,KAAM,CAACC,KAAiBC,IAEtBC,QAAQC,IAAI,kBAAmBH,KAAQC,GACzCG,MAAO,CAACJ,KAAiBC,IAEvBC,QAAQE,MAAM,kBAAmBJ,KAAQC,WAStC,MAAMI,kBAAoB,EAC/BC,eACAC,cACAC,mBACEC,UAAWC,EACXC,MAAOC,EACPC,QAASL,GACP,GACJM,OAAQC,EACRC,OAAQC,MAER,MAAMC,OAAEA,EAAMC,QAAEA,EAAOC,YAAEA,GAAgBL,GAAgB,GACnDC,EAASC,GAAgBnB,eAExBuB,EAAWC,GAAgBpC,UAAS,GAErCqC,EAAetC,OAAyB,MACxCuC,EAAkBvC,OAA4B,MAC9CwC,EAAgBxC,OAAqC,MACrDyC,EAAezC,QAAO,GACtB0C,EAAe1C,QAAO,GACtB2C,EAAY3C,SACZ4C,EAAwB5C,QAAO,GAC/B6C,EAAc7C,QAAO,GACrB8C,EAAoB9C,OA5CR,OA6CZ+C,EAAiB/C,QAAO,GACxBgD,EAAmBhD,QAAO,GAC1BiD,EAAkBjD,OAAO,GAEzBkD,EAAclD,OAAmC,OAEhDmD,EAAaC,GAAkBnD,UAAS,GACzCoD,EAAiBrD,QAAO,GAKxBsD,EAAiBtD,OAAuB,IAGxCuD,EAA0BzD,aAAY,KAEvCyC,EAAgBiB,SACiB,WAAlCjB,EAAgBiB,QAAQC,QAExBlB,EAAgBiB,QAAU,IAAKE,OAAOC,cACnCD,OAAeE,oBAAoB,CACpCC,WAnEY,MAoEZC,YAAa,cAGVvB,EAAgBiB,UACtB,IAEGO,EAAuBjE,aAC1BkE,IACC,IAAIvC,GAAwByB,EAAYM,SAAYX,EAAYW,QAiB9DN,EAAYM,SAASS,aAAaD,OAjBqC,CACvE,MAAME,EAAW,IAAIrE,oBACnBsE,SAASC,eAAe3C,GACxB,IACMF,GAAqBhB,qBAAqByD,KAKlDE,EAASG,QAEL1C,GACFxB,iBAAiB+D,EAAUvC,GAG7BuB,EAAYM,QAAUU,CACxB,CAEA,GAEF,IAGII,EAAmBxE,aAAYyE,UACnC,IAAI3B,EAAsBY,QAA1B,CAEA/C,gBAAgBkC,EAAUa,SAE1B,IAEEb,EAAUa,cAAgBgB,UAAUC,aAAaC,aAAa,CAC5DC,MAAO,CACLd,WA5GU,MA6GVe,aA5Gc,EA6GdC,iBAAkB,CAChBC,OAAO,GAETC,iBAAkB,CAChBD,OAAO,GAETE,gBAAiB,CACfF,OAAO,MAKb,MAAMG,EAAe1B,IAEfS,EAASiB,EAAaC,wBAAwBvC,EAAUa,SAGxD2B,EAAaF,EAAaG,2BAChCD,EAAWE,UAAUC,OAAS,GAC9BH,EAAWI,KAAKD,MAAQ,GACxBH,EAAWK,MAAMF,MAAQ,EACzBH,EAAWM,OAAOH,MAAQ,KAC1BH,EAAWO,QAAQJ,MAAQ,GAG3B,MAAMK,EAAWV,EAAaW,aAC9BD,EAASE,KAAKP,MAAQ,IAGtBtB,EAAO8B,QAAQX,GAAYW,QAAQH,GAEnC5B,EAAqBC,GAErBpB,EAAsBY,SAAU,CAClC,CAAE,MAAOuC,GAGP,MAFAhE,EAAOZ,MAAM,iCAAkC4E,GAC/C5D,IAAc4D,GACRA,CACR,CAhDmC,CAgDnC,GACC,CAACxC,EAAyBQ,KAEvBiC,gBAAEA,EAAeC,eAAEA,EAAcC,aAAEA,GAAiBnG,SAAQ,KAChE,IAAIoG,EAA4C,KAC5CC,EAAgD,KA4EpD,MAAO,CACLJ,gBA3EYzB,UACZ,GAAK5B,EAAUa,QAEf,IACE,MAAMyB,EAAe1B,IAGf8C,OAA8BC,IAAhBhF,GAA6C,KAAhBA,EAC3CiF,EAAaF,EACfG,IAAIC,gBACF,IAAIC,KAAK,CAACxG,sBAAuB,CAC/ByG,KAAM,4BAGVrF,EACJ,UACQ2D,EAAa2B,aAAaC,UAAUN,EAC5C,C,QACMF,GACFG,IAAIM,gBAAgBP,EAExB,CAEAH,EAAanB,EAAaC,wBAAwBvC,EAAUa,SAE5D2C,EAAmB,IAAIY,iBACrB9B,EACA,kBACA,CACE+B,eAAgB,EAChBC,gBAAiB,EACjBrC,aAAc,EACdsC,iBAAkB,CAChBrD,WAAYoB,EAAapB,cAM/BsC,EAAiBgB,KAAKC,UAAaC,IACjC,GAAI/E,EAAakB,SAAS8D,aAAeC,UAAUC,KAAM,CACvD,MAAMC,KAAEA,EAAIC,UAAEA,GAAcL,EAAMI,KAC5BE,EAAarH,eAAemH,GAElCnF,EAAakB,QAAQoE,KACnBC,KAAKC,UAAU,CACbT,MAAO,QACPU,MAAO,CACLC,QAASL,EACTD,eAIR,GAGFtB,EAAWN,QAAQK,EACrB,CAAE,MAAOhF,GACPY,EAAOZ,MAAM,oCAAqCA,GAClDgB,IAAchB,EAChB,GAgBA8E,eAbW,KACPE,IACFA,EAAiB8B,aACjB9B,EAAmB,MAEjBC,IACFA,EAAW6B,aACX7B,EAAa,KACf,EAMAF,eAAgBC,EACjB,GACA,CAAC5C,EAAyBjC,IAEvB4G,EAAoBpI,aACvBkI,IAECzE,IAEA,IAEE,MAAM4E,EAAY/H,kBAAkB4H,GAC9BI,EAAc/H,wBAAwB8H,GAGtCE,EAvPM,QAwPVvF,EAAkBU,QACd4E,EACA5H,cACE4H,EACAtF,EAAkBU,QA5Pd,OAgQZF,EAAeE,QAAQ8E,KAAKD,GAI1B/E,EAAeE,QAAQ+E,QACrB,CAACC,EAAKC,IAAUD,EAAMC,EAAMC,QAC5B,IA/MShI,OAkNXiI,GAEJ,CAAE,MAAOxH,GACPY,EAAOZ,MAAM,gCAAiCA,EAChD,IAEF,CAACoC,IAGGoF,EAAgB7I,aAAY,KAEhC,MAAMmF,EAAe1B,IACrB,IAAK0B,GAAgB5B,EAAeG,QAAS,OAG7C,IAAIoF,EAEJ,GAAsC,IAAlCtF,EAAeE,QAAQkF,OAAc,CACvCrF,EAAeG,SAAU,EACzBnB,GAAa,GAEbC,EAAakB,SAASoE,KACpBC,KAAKC,UAAU,CACbT,MAAO,cACPU,MAAO,CACLc,aAAa,MAKnB7F,EAAiBQ,SAAU,EAG3B,MAAMsF,EAAgBC,KAAKC,MApPP,EAqPlBlG,EAAkBU,QAA4B,GAEhDoF,EAAY,IAAIK,aAAaH,GAAeI,KAAK,EACnD,KAAO,CACAlG,EAAiBQ,UACpBlB,EAAakB,SAASoE,KACpBC,KAAKC,UAAU,CACbT,MAAO,cACPU,MAAO,CACLc,aAAa,MAInB7F,EAAiBQ,SAAU,GAG7BH,EAAeG,SAAU,EACzBnB,GAAa,GAEb,IAAI8G,EAAc,EAClB,MAAMC,EAAyB,GAE/B,KAAO9F,EAAeE,QAAQkF,OAAS,GAAKS,EA1Q7BzI,OA0QuD,CACpE,MAAM+H,EAAQnF,EAAeE,QAAQ6F,QACrCD,EAAOd,KAAKG,GACZU,GAAeV,EAAMC,MACvB,CAGAE,EAAY,IAAIK,aAAaE,GAC7B,IAAIG,EAAS,EACb,IAAK,MAAMb,KAASW,EAClBR,EAAUW,IAAId,EAAOa,GACrBA,GAAUb,EAAMC,MAEpB,CAGA,MAAMc,EAAcvE,EAAawE,aAC/B,EACAb,EAAUF,OAnVI,OAwVhBc,EAAYE,eAAe,GAAGH,IAAIX,GAGlC,MAAM5E,EAASiB,EAAa0E,qBAC5B3F,EAAO4F,OAASJ,EAEhBxF,EAAO8B,QAAQb,EAAa4E,aAG5B9F,EAAqBC,GAGrBA,EAAO8F,QAAU,KACfzG,EAAeG,SAAU,EAErBF,EAAeE,QAAQkF,OAAS,EAClCC,KAEAtG,GAAa,GACbC,EAAakB,SAASoE,KACpBC,KAAKC,UAAU,CACbT,MAAO,cACPU,MAAO,CACLc,aAAa,MAInB7F,EAAiBQ,SAAU,EAEvBT,EAAeS,SACjBlB,EAAakB,SAASuG,QAE1B,EAIF/F,EAAOK,QAEP7B,EAAcgB,QAAUQ,EAExBvB,EAAae,SAAU,CAAI,GAC1B,CAACD,EAAyBQ,IAEvBiG,EAAsBlK,aAAYyE,MAAO0F,IAC7C,IACwB,UAAlBA,EAAQ5C,OAAqB4C,EAAQlC,OAAOC,SACd,IAA5B/E,EAAgBO,UAClBP,EAAgBO,QAAU0G,KAAKC,MAC/BpI,EAAOjB,KAAK,qBAAsBmC,EAAgBO,UAEpDV,EAAkBU,QAAUyG,EAAQG,aA1YxB,MA2YZlC,EAAkB+B,EAAQlC,MAAMC,UACvB,CAAC,QAAS,SAASqC,SAASJ,EAAQ5C,QAC7CtF,EAAOjB,KAAK,UACZwC,EAAeE,QAAU,IACE,QAAlByG,EAAQ5C,OACjBtF,EAAOjB,KAAK,sBACZwB,EAAakB,SAASoE,KAAKC,KAAKC,UAAU,CAAET,MAAO,UACxB,SAAlB4C,EAAQ5C,OACjBtF,EAAOjB,KAAK,uBACRwB,EAAakB,SAAS8D,aAAeC,UAAUC,OACjDzE,EAAeS,SAAU,IAG3BzB,EAAOjB,KAAK,0BAA2BmJ,EAE3C,CAAE,MAAO9I,GACPY,EAAOZ,MAAM,kCAAmCA,EAClD,IACC,IAEGmJ,EAAUxK,aACbkE,IACC,IAAInB,EAAYW,QAAhB,CAkCA,GAjCAX,EAAYW,SAAU,EAGtByC,IAGI3D,EAAakB,UAEblB,EAAakB,QAAQ8D,aAAeC,UAAUC,MAC9ClF,EAAakB,QAAQ8D,aAAeC,UAAUgD,YAE9CjI,EAAakB,QAAQuG,QAEvBzH,EAAakB,QAAU,MAGzBN,EAAYM,SAASgH,OACrBtH,EAAYM,SAASiH,UAGjBlI,EAAgBiB,UAClBjB,EAAgBiB,QAAQuG,QACxBxH,EAAgBiB,QAAU,MAIxBhB,EAAcgB,UAChBhB,EAAcgB,QAAQgH,OACtBhI,EAAcgB,QAAQyE,aACtBzF,EAAcgB,QAAU,MAItBb,EAAUa,QAAS,CACNb,EAAUa,QAAQkH,YAC1BC,SAASC,IACdA,EAAMJ,OACNI,EAAMC,SAAU,EAChBlI,EAAUa,SAASsH,YAAYF,EAAM,IAEvCjI,EAAUa,aAAU8C,CACtB,CAGAhD,EAAeE,QAAU,GACzBf,EAAae,SAAU,EACvBZ,EAAsBY,SAAU,EAChCd,EAAac,SAAU,EACvBH,EAAeG,SAAU,EACzBT,EAAeS,SAAU,EACzBnB,GAAa,GAGbe,GAAe,GAGflB,IAAU8B,EAzDe,CAyDR,GAEnB,CAACiC,EAAgB/D,IAGb4D,EAAUhG,aAAY,KAE1B,IACGuB,GACDiB,EAAakB,SACbX,EAAYW,SACZL,EAEA,OAGFN,EAAYW,SAAU,EACtBd,EAAac,SAAU,EAEvB,MAAMuH,EAAK,IAAIxD,UAAUlG,GAEzBiB,EAAakB,QAAUuH,EAEvBA,EAAGC,OAASzG,UACN1B,EAAYW,QACduH,EAAGhB,SAGL3G,GAAe,SAETkB,UACA0B,IACN+E,EAAGnD,KAAKC,KAAKC,UAAU,CAAET,MAAO,WAAW,EAG7C0D,EAAG3D,UAAaC,IACd,IAAIxE,EAAYW,QAChB,IACE,MAAMiE,EAAOI,KAAKoD,MAAM5D,EAAMI,MAC1BA,GACFuC,EAAoBvC,EAExB,CAAE,MAAOtG,GACPY,EAAOZ,MAAM,mCAAoCA,EACnD,GAGF4J,EAAGG,QAAWnF,IAEG,iBADAA,EAAEoF,SAEfpJ,EAAOjB,KAAK,gBACZsK,SAASC,UAGNxI,EAAYW,SACf8G,EAAQ,UAGVrE,GAAgB,EAGlB8E,EAAGO,QAAWnK,IACZY,EAAOZ,MAAM,mBAAoBA,GACjCgB,IAAchB,GAET0B,EAAYW,SACf8G,EAAQ,SACV,CACD,GACA,CACDjJ,EACAY,EACAC,EACAC,EACAmC,EACA0B,EACA7C,IAGI8E,EAAanI,aAAY,KAC7BwK,EAAQ,SAAS,GAChB,CAACA,IAEEiB,EAAYzL,aACf0L,IA2CC,GAzCIlJ,EAAakB,UACflB,EAAakB,QAAQuG,QACrBzH,EAAakB,QAAU,MAIzBX,EAAYW,SAAU,EACtBd,EAAac,SAAU,EACvBf,EAAae,SAAU,EACvBZ,EAAsBY,SAAU,EAChCH,EAAeG,SAAU,EACzBT,EAAeS,SAAU,EAGzBJ,GAAe,GACff,GAAa,GAGbiB,EAAeE,QAAU,GAGrBjB,EAAgBiB,UAClBjB,EAAgBiB,QAAQuG,QACxBxH,EAAgBiB,QAAU,MAIxBhB,EAAcgB,UAChBhB,EAAcgB,QAAQgH,OACtBhI,EAAcgB,QAAQyE,aACtBzF,EAAcgB,QAAU,MAItBN,EAAYM,UACdN,EAAYM,QAAQgH,OACpBtH,EAAYM,QAAQiH,UACpBvH,EAAYM,QAAU,MAIpBb,EAAUa,QAAS,CACNb,EAAUa,QAAQkH,YAC1BC,SAASC,IACdA,EAAMJ,OACNI,EAAMC,SAAU,EAChBlI,EAAUa,SAASsH,YAAYF,EAAM,IAEvCjI,EAAUa,aAAU8C,CACtB,CAMA,GAHAL,KAGK5E,EAEH,YADAU,EAAOZ,MAAM,8CAIf,MAAM4J,EAAK,IAAIxD,UAAUlG,GAEzBiB,EAAakB,QAAUuH,EAEvBA,EAAGC,OAASzG,UACN1B,EAAYW,QACduH,EAAGhB,SAGL3G,GAAe,SAETkB,UACA0B,IACN+E,EAAGnD,KAAKC,KAAKC,UAAU,CAAET,MAAO,WAChCmE,MAAuB,EAGzBT,EAAG3D,UAAaC,IACd,IAAIxE,EAAYW,QAChB,IACE,MAAMiE,EAAOI,KAAKoD,MAAM5D,EAAMI,MAC1BA,GACFuC,EAAoBvC,EAExB,CAAE,MAAOtG,GACPY,EAAOZ,MAAM,mCAAoCA,GACjDgB,IAAchB,EAChB,GAGF4J,EAAGG,QAAWnF,IAEG,iBADAA,EAAEoF,SAEfpJ,EAAOjB,KAAK,gBACZsK,SAASC,UAGNxI,EAAYW,SACf8G,EAAQ,UAGVrE,GAAgB,EAGlB8E,EAAGO,QAAWnK,IACZY,EAAOZ,MAAM,mBAAoBA,GACjCgB,IAAchB,GAET0B,EAAYW,SACf8G,EAAQ,SACV,CACD,GAEH,CACEjJ,EACAY,EACAC,EACAC,EACAmC,EACA0B,EACAC,EACAqE,IAIJ,MAAO,CACLnH,cACAf,YACAqJ,eAAgBzF,EAChB0F,cAAezF,EACf0F,YAAazF,EACbJ,UACAmC,aACAsD,YACD","ignoreList":[]}